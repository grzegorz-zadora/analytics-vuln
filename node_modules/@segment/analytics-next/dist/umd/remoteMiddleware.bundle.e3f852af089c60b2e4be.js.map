{"version":3,"sources":["webpack://@segment/analytics-next/./src/plugins/remote-middleware/index.ts"],"names":["path","window","analytics","_cdn","remoteMiddlewares","ctx","settings","obfuscate","Promise","remoteMiddleware","enabledMiddleware","names","Object","entries","filter","map","scripts","name","nonNamespaced","replace","bundleName","btoa","fullPath","log","stats","increment","all","Boolean"],"mappings":"2OAQMA,GAD4B,QAAzB,EAAmB,QAAnB,EAAGC,OAAOC,iBAAS,eAAEC,YAAI,SAAI,UACnB,qBAEZ,SAAeC,EACpBC,EACAC,EACAC,G,iCACCC,SAAO,W,yEACR,OAAI,SACK,CAAC,EAAD,KAGHC,EAA6C,QAA7B,EAAGH,EAASI,yBAAiB,QAAI,GACjDC,EAAQC,OAAOC,QAAQJ,GAC1BK,QAAO,SAAC,GAAE,KAAe,OAAN,QACnBC,KAAI,SAAC,GAAW,OAAN,QAEPC,EAAUL,EAAMI,KAAI,SAAOE,GAAI,2C,oEAC7BC,EAAgBD,EAAKE,QAAQ,YAAa,IAC5CC,EAAaF,EACbX,IACFa,EAAaC,KAAKH,GAAeC,QAAQ,KAAM,KAE3CG,EAActB,EAAI,eAAeoB,EAAU,WAAWA,EAAU,S,iBAGpE,O,sBAAA,IAAM,OAAWE,I,OAEjB,OAFA,SAEO,CAAP,EAAOrB,OAAUiB,EAAa,e,yBAE9Bb,EAAIkB,IAAI,QAAS,GACjBlB,EAAImB,MAAMC,UAAU,4B,iCAIP,GAAMjB,QAAQkB,IAAIV,K,OAGnC,MAAO,CAAP,EAHiB,SACOF,OAAOa","file":"remoteMiddleware.bundle.e3f852af089c60b2e4be.js","sourcesContent":["import { LegacySettings } from '../../browser'\nimport { Context } from '../../core/context'\nimport { isServer } from '../../core/environment'\nimport { loadScript } from '../../lib/load-script'\nimport { getCDN } from '../../lib/parse-cdn'\nimport { MiddlewareFunction } from '../middleware'\n\nconst cdn = window.analytics?._cdn ?? getCDN()\nconst path = cdn + '/next-integrations'\n\nexport async function remoteMiddlewares(\n  ctx: Context,\n  settings: LegacySettings,\n  obfuscate?: boolean\n): Promise<MiddlewareFunction[]> {\n  if (isServer()) {\n    return []\n  }\n\n  const remoteMiddleware = settings.enabledMiddleware ?? {}\n  const names = Object.entries(remoteMiddleware)\n    .filter(([_, enabled]) => enabled)\n    .map(([name]) => name)\n\n  const scripts = names.map(async (name) => {\n    const nonNamespaced = name.replace('@segment/', '')\n    let bundleName = nonNamespaced\n    if (obfuscate) {\n      bundleName = btoa(nonNamespaced).replace(/=/g, '')\n    }\n    const fullPath = `${path}/middleware/${bundleName}/latest/${bundleName}.js.gz`\n\n    try {\n      await loadScript(fullPath)\n      // @ts-ignore\n      return window[`${nonNamespaced}Middleware`] as MiddlewareFunction\n    } catch (error) {\n      ctx.log('error', error)\n      ctx.stats.increment('failed_remote_middleware')\n    }\n  })\n\n  let middleware = await Promise.all(scripts)\n  middleware = middleware.filter(Boolean)\n\n  return middleware as MiddlewareFunction[]\n}\n"],"sourceRoot":""}