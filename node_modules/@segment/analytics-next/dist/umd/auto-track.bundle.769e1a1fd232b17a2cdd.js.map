{"version":3,"sources":["webpack://@segment/analytics-next/./src/core/auto-track.ts"],"names":["link","links","event","properties","Element","toArray","forEach","el","addEventListener","elementEvent","ev","Function","props","href","getAttribute","getAttributeNS","getElementsByTagName","trackEvent","track","settings","timeout","element","target","linkNewTab","typedEvent","ctrlKey","shiftKey","metaKey","button","userNewTab","preventDefault","returnValue","catch","console","error","then","window","location","this","form","forms","HTMLFormElement","TypeError","handler","submit","$","jQuery","Zepto"],"mappings":"yNA4CO,SAASA,EAEdC,EACAC,EACAC,GAJF,WAQE,OAAKF,IAGDA,aAAiBG,QACR,CAACH,GACH,YAAaA,EACXA,EAAMI,UAENJ,GAGJK,SAAQ,SAACC,GAChBA,EAAGC,iBACD,SACA,SAACC,G,QACOC,EAAKR,aAAiBS,SAAWT,EAAMK,GAAML,EAC7CU,EACJT,aAAsBQ,SAAWR,EAAWI,GAAMJ,EAC9CU,EACJN,EAAGO,aAAa,SAChBP,EAAGQ,eAAe,+BAAgC,SAClDR,EAAGO,aAAa,gBACe,QADF,EAC7BP,EAAGS,qBAAqB,KAAK,UAAE,eAAEF,aAAa,SAE1CG,GAAa,OACjB,EAAKC,MAAMR,EAAIE,GACM,QADA,EACrB,EAAKO,SAASC,eAAO,QAAI,MA7CnC,SAAoBC,EAA4BR,GAC9C,QAAuB,WAAnBQ,EAAQC,SAAuBT,IAgD1BU,CAAWhB,EAAyBM,IApE/C,SAAoBX,GAClB,IAAMsB,EAAatB,EAMnB,SACEsB,EAAWC,SACXD,EAAWE,UACXF,EAAWG,SACVH,EAAWI,QAA+B,GAArBJ,EAAWI,QA0D1BC,CAAWpB,IAERI,IACFJ,EAAaqB,eACTrB,EAAaqB,iBACZrB,EAAasB,aAAc,EAChCd,EACGe,MAAMC,QAAQC,OACdC,MAAK,WACJC,OAAOC,SAASxB,KAAOA,KAExBmB,MAAMC,QAAQC,WAIvB,MAIGI,MAjDEA,KAsDJ,SAASC,EAEdC,EACAtC,EACAC,GAJF,WAOE,OAAKqC,GACDA,aAAiBC,kBAAiBD,EAAQ,CAACA,IAE9BA,EAERlC,SAAQ,SAACC,GAChB,KAAMA,aAAcH,SAClB,MAAM,IAAIsC,UAAU,mDACtB,IAAMC,EAAU,SAAClC,G,MACfA,EAAaqB,eACTrB,EAAaqB,iBACZrB,EAAasB,aAAc,EAEhC,IAAMrB,EAAKR,aAAiBS,SAAWT,EAAMK,GAAML,EAC7CU,EAAQT,aAAsBQ,SAAWR,EAAWI,GAAMJ,GAE7C,OACjB,EAAKe,MAAMR,EAAIE,GACM,QADA,EACrB,EAAKO,SAASC,eAAO,QAAI,KAIxBY,MAAMC,QAAQC,OACdC,MAAK,WACJ5B,EAAGqC,YAEJZ,MAAMC,QAAQC,QAKbW,EAAIT,OAAOU,QAAUV,OAAOW,MAC9BF,EACFA,EAAEtC,GAAIqC,OAAOD,GAGbpC,EAAGC,iBAAiB,SAAUmC,GAAS,MAIpCL,MAxCYA","file":"auto-track.bundle.769e1a1fd232b17a2cdd.js","sourcesContent":["import { Analytics } from '../analytics'\nimport { SegmentEvent } from '../core/events'\nimport { pTimeout } from './callback'\n\ndeclare global {\n  interface Window {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    jQuery: any\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Zepto: any\n  }\n}\n\n// Check if a user is opening the link in a new tab\nfunction userNewTab(event: Event): boolean {\n  const typedEvent = event as Event & {\n    ctrlKey: boolean\n    shiftKey: boolean\n    metaKey: boolean\n    button: number\n  }\n  if (\n    typedEvent.ctrlKey ||\n    typedEvent.shiftKey ||\n    typedEvent.metaKey ||\n    (typedEvent.button && typedEvent.button == 1)\n  ) {\n    return true\n  }\n  return false\n}\n\n// Check if the link opens in new tab\nfunction linkNewTab(element: HTMLAnchorElement, href: string | null): boolean {\n  if (element.target === '_blank' && href) {\n    return true\n  }\n  return false\n}\n\nexport interface JQueryShim<TElement = HTMLElement> {\n  toArray(): TElement[]\n}\n\nexport function link(\n  this: Analytics,\n  links: Element | Array<Element> | JQueryShim | null,\n  event: string | Function,\n  properties?: SegmentEvent['properties'] | Function\n): Analytics {\n  let elements: Array<Element> = []\n  // always arrays, handles jquery\n  if (!links) {\n    return this\n  }\n  if (links instanceof Element) {\n    elements = [links]\n  } else if ('toArray' in links) {\n    elements = links.toArray()\n  } else {\n    elements = links\n  }\n\n  elements.forEach((el: Element) => {\n    el.addEventListener(\n      'click',\n      (elementEvent: Event) => {\n        const ev = event instanceof Function ? event(el) : event\n        const props =\n          properties instanceof Function ? properties(el) : properties\n        const href =\n          el.getAttribute('href') ||\n          el.getAttributeNS('http://www.w3.org/1999/xlink', 'href') ||\n          el.getAttribute('xlink:href') ||\n          el.getElementsByTagName('a')[0]?.getAttribute('href')\n\n        const trackEvent = pTimeout(\n          this.track(ev, props),\n          this.settings.timeout ?? 500\n        )\n\n        if (\n          !linkNewTab(el as HTMLAnchorElement, href) &&\n          !userNewTab(elementEvent)\n        ) {\n          if (href) {\n            elementEvent.preventDefault\n              ? elementEvent.preventDefault()\n              : (elementEvent.returnValue = false)\n            trackEvent\n              .catch(console.error)\n              .then(() => {\n                window.location.href = href\n              })\n              .catch(console.error)\n          }\n        }\n      },\n      false\n    )\n  })\n\n  return this\n}\n\nexport type LinkArgs = Parameters<typeof link>\n\nexport function form(\n  this: Analytics,\n  forms: HTMLFormElement | Array<HTMLFormElement> | null,\n  event: string | Function,\n  properties?: SegmentEvent['properties'] | Function\n): Analytics {\n  // always arrays, handles jquery\n  if (!forms) return this\n  if (forms instanceof HTMLFormElement) forms = [forms]\n\n  const elements = forms\n\n  elements.forEach((el) => {\n    if (!(el instanceof Element))\n      throw new TypeError('Must pass HTMLElement to trackForm/trackSubmit.')\n    const handler = (elementEvent: Event): void => {\n      elementEvent.preventDefault\n        ? elementEvent.preventDefault()\n        : (elementEvent.returnValue = false)\n\n      const ev = event instanceof Function ? event(el) : event\n      const props = properties instanceof Function ? properties(el) : properties\n\n      const trackEvent = pTimeout(\n        this.track(ev, props),\n        this.settings.timeout ?? 500\n      )\n\n      trackEvent\n        .catch(console.error)\n        .then(() => {\n          el.submit()\n        })\n        .catch(console.error)\n    }\n\n    // Support the events happening through jQuery or Zepto instead of through\n    // the normal DOM API, because `el.submit` doesn't bubble up events...\n    const $ = window.jQuery || window.Zepto\n    if ($) {\n      $(el).submit(handler)\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-misused-promises\n      el.addEventListener('submit', handler, false)\n    }\n  })\n\n  return this\n}\n\nexport type FormArgs = Parameters<typeof form>\n"],"sourceRoot":""}