(self.webpackChunk_segment_analytics_next=self.webpackChunk_segment_analytics_next||[]).push([[464,714],{9159:function(n,t,e){"use strict";function i(n,t){var e,i;return"boolean"==typeof(null==t?void 0:t.enabled)?t.enabled:null===(i=null===(e=null==n?void 0:n.__default)||void 0===e?void 0:e.enabled)||void 0===i||i}e.d(t,{n:function(){return i}})},3234:function(n,t,e){"use strict";e.r(t),e.d(t,{LegacyDestination:function(){return J},ajsDestinations:function(){return j}});var i,r,o=e(655),s=e(9969),a=e(8231),u=e(7372),l=e(4083),c=e(57),d=e(5764),h=e(9159),f=e(7851),v=e(3319),p=e(306),g=e(2734),m=e(5130),y=e(46),w=e(6673),b=(null!==(r=null===(i=window.analytics)||void 0===i?void 0:i._cdn)&&void 0!==r?r:(0,y.V)())+"/next-integrations";function _(n){return n.toLowerCase().replace(".","").replace(/\s+/g,"-")}function P(n,t){return void 0===t&&(t=!1),t?btoa(n).replace(/=/g,""):void 0}function k(n,t,i,r,s,a){return(0,o.mG)(this,void 0,Promise,(function(){var u,l,c,d,h,f,v;return(0,o.Jh)(this,(function(p){switch(p.label){case 0:u=_(i),l=P(u,a),c=b+"/integrations/"+(null!=l?l:u)+"/"+r+"/"+(null!=l?l:u)+".dynamic.js.gz",p.label=1;case 1:return p.trys.push([1,3,,4]),[4,(0,w.v)(c)];case 2:return p.sent(),function(n,t,i){var r,s,a;try{var u=(null!==(a=null===(s=null===(r=e.g.window)||void 0===r?void 0:r.performance)||void 0===s?void 0:s.getEntriesByName(n,"resource"))&&void 0!==a?a:[])[0];u&&t.stats.gauge("legacy_destination_time",Math.round(u.duration),(0,o.pr)([i],u.duration<100?["cached"]:[]))}catch(n){}}(c,n,i),[3,4];case 3:throw d=p.sent(),n.stats.gauge("legacy_destination_time",-1,["plugin:"+i,"failed"]),d;case 4:return h=window[u+"Deps"],[4,Promise.all(h.map((function(n){return(0,w.v)(b+n+".gz")})))];case 5:return p.sent(),window[u+"Loader"](),(f=window[u+"Integration"]).Integration&&(f({user:function(){return t.user()},addIntegration:function(){}}),f=f.Integration),(v=new f(s)).analytics=t,[2,v]}}))}))}function G(n,t){return(0,o.mG)(this,void 0,Promise,(function(){var e,i=this;return(0,o.Jh)(this,(function(r){switch(r.label){case 0:return e=[],(0,a.s)()?[2,t]:[4,(0,v.x)((function(){return t.length>0&&(0,a.G)()}),(function(){return(0,o.mG)(i,void 0,void 0,(function(){var i,r;return(0,o.Jh)(this,(function(o){switch(o.label){case 0:return(i=t.pop())?[4,(0,c.a)(i,n)]:[2];case 1:return r=o.sent(),r instanceof u._||e.push(i),[2]}}))}))}))];case 1:return r.sent(),e.map((function(n){return t.pushWithBackoff(n)})),[2,t]}}))}))}var J=function(){function n(n,t,e,i){void 0===e&&(e={}),this.options={},this.type="destination",this.middleware=[],this._ready=!1,this._initialized=!1,this.flushing=!1,this.name=n,this.version=t,this.settings=(0,o.pi)({},e),this.settings.type&&"browser"===this.settings.type&&delete this.settings.type,this.options=i,this.buffer=new p.$(4,"dest-"+n),this.scheduleFlush()}return n.prototype.isLoaded=function(){return this._ready},n.prototype.ready=function(){var n;return null!==(n=this.onReady)&&void 0!==n?n:Promise.resolve()},n.prototype.load=function(n,t){return(0,o.mG)(this,void 0,Promise,(function(){var e,i=this;return(0,o.Jh)(this,(function(r){switch(r.label){case 0:return this._ready||void 0!==this.onReady?[2]:(e=this,[4,k(n,t,this.name,this.version,this.settings,this.options.obfuscate)]);case 1:e.integration=r.sent(),this.onReady=new Promise((function(n){i.integration.once("ready",(function(){i._ready=!0,n(!0)}))})),this.onInitialize=new Promise((function(n){i.integration.on("initialize",(function(){i._initialized=!0,n(!0)}))}));try{n.stats.increment("analytics_js.integration.invoke",1,["method:initialize","integration_name:"+this.name]),this.integration.initialize()}catch(t){throw n.stats.increment("analytics_js.integration.invoke.error",1,["method:initialize","integration_name:"+this.name]),t}return[2]}}))}))},n.prototype.unload=function(n,t){return function(n,t,e){return(0,o.mG)(this,void 0,Promise,(function(){var i,r,s;return(0,o.Jh)(this,(function(o){return i=_(n),r=P(n,e),s=b+"/integrations/"+(null!=r?r:i)+"/"+t+"/"+(null!=r?r:i)+".dynamic.js.gz",[2,(0,w.t)(s)]}))}))}(this.name,this.version,this.options.obfuscate)},n.prototype.addMiddleware=function(){for(var n,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.middleware=(n=this.middleware).concat.apply(n,t)},n.prototype.shouldBuffer=function(n){return"page"!==n.event.type&&((0,a.s)()||!1===this._ready||!1===this._initialized)},n.prototype.send=function(n,t,e){var i,r;return(0,o.mG)(this,void 0,Promise,(function(){var s,a,l,c,f,v;return(0,o.Jh)(this,(function(p){switch(p.label){case 0:if(this.shouldBuffer(n))return this.buffer.push(n),this.scheduleFlush(),[2,n];if(s=null===(r=null===(i=this.options)||void 0===i?void 0:i.plan)||void 0===r?void 0:r.track,a=n.event.event,s&&a&&"Segment.io"!==this.name){if(l=s[a],!(0,h.n)(s,l))return n.updateEvent("integrations",(0,o.pi)((0,o.pi)({},n.event.integrations),{All:!1,"Segment.io":!0})),n.cancel(new u.Y({retry:!1,reason:"Event "+a+" disabled for integration "+this.name+" in tracking plan",type:"Dropped by plan"})),[2,n];if(n.updateEvent("integrations",(0,o.pi)((0,o.pi)({},n.event.integrations),null==l?void 0:l.integrations)),(null==l?void 0:l.enabled)&&!1===(null==l?void 0:l.integrations[this.name]))return n.cancel(new u.Y({retry:!1,reason:"Event "+a+" disabled for integration "+this.name+" in tracking plan",type:"Dropped by plan"})),[2,n]}return[4,(0,g.applyDestinationMiddleware)(this.name,(m=n.event,JSON.parse(JSON.stringify(m))),this.middleware)];case 1:if(null===(c=p.sent()))return[2,n];f=new t(c,{}),n.stats.increment("analytics_js.integration.invoke",1,["method:"+e,"integration_name:"+this.name]),p.label=2;case 2:return p.trys.push([2,5,,6]),this.integration?[4,(0,d.O)(this.integration.invoke.call(this.integration,e,f))]:[3,4];case 3:p.sent(),p.label=4;case 4:return[3,6];case 5:throw v=p.sent(),n.stats.increment("analytics_js.integration.invoke.error",1,["method:"+e,"integration_name:"+this.name]),v;case 6:return[2,n]}var m}))}))},n.prototype.track=function(n){return(0,o.mG)(this,void 0,Promise,(function(){return(0,o.Jh)(this,(function(t){return[2,this.send(n,s.Track,"track")]}))}))},n.prototype.page=function(n){var t;return(0,o.mG)(this,void 0,Promise,(function(){var e=this;return(0,o.Jh)(this,(function(i){return(null===(t=this.integration)||void 0===t?void 0:t._assumesPageview)&&!this._initialized&&this.integration.initialize(),[2,this.onInitialize.then((function(){return e.send(n,s.Page,"page")}))]}))}))},n.prototype.identify=function(n){return(0,o.mG)(this,void 0,Promise,(function(){return(0,o.Jh)(this,(function(t){return[2,this.send(n,s.Identify,"identify")]}))}))},n.prototype.alias=function(n){return(0,o.mG)(this,void 0,Promise,(function(){return(0,o.Jh)(this,(function(t){return[2,this.send(n,s.Alias,"alias")]}))}))},n.prototype.group=function(n){return(0,o.mG)(this,void 0,Promise,(function(){return(0,o.Jh)(this,(function(t){return[2,this.send(n,s.Group,"group")]}))}))},n.prototype.scheduleFlush=function(){var n=this;this.flushing||setTimeout((function(){return(0,o.mG)(n,void 0,void 0,(function(){var n;return(0,o.Jh)(this,(function(t){switch(t.label){case 0:return this.flushing=!0,n=this,[4,G(this,this.buffer)];case 1:return n.buffer=t.sent(),this.flushing=!1,this.buffer.todo>0&&this.scheduleFlush(),[2]}}))}))}),5e3*Math.random())},n}();function j(n,t,e){var i,r;return void 0===t&&(t={}),(0,o.mG)(this,void 0,Promise,(function(){var s,a,u;return(0,o.Jh)(this,(function(o){return(0,l.s)()?[2,[]]:(n.plan&&((e=null!=e?e:{}).plan=n.plan),s=null!==(r=null===(i=n.middlewareSettings)||void 0===i?void 0:i.routingRules)&&void 0!==r?r:[],c=s,a=function(n){var t=n.payload,e=n.integration,i=n.next;new m.Store(c).getRulesByDestinationName(e).forEach((function(n){for(var e=n.matchers,r=n.transformers,o=0;o<e.length;o++)if(m.matches(t.obj,e[o])&&(t.obj=m.transform(t.obj,r[o]),null===t.obj))return i(null)})),i(t)},u=(0,f.o)(n,null!=e?e:{}),[2,Object.entries(n.integrations).map((function(n){var i,r=n[0],o=n[1];if(!r.startsWith("Segment")){var l=!1===t.All&&void 0===t[r];if(!1!==t[r]&&!l){var c=o.type,d=o.bundlingStatus,h=o.versionSettings;if(("unbundled"!==d&&("browser"===c||(null===(i=null==h?void 0:h.componentTypes)||void 0===i?void 0:i.includes("browser")))||"Segment.io"===r)&&"Iterable"!==r){var f=function(n){var t,e,i,r;return null!==(r=null!==(e=null===(t=n.versionSettings)||void 0===t?void 0:t.override)&&void 0!==e?e:null===(i=n.versionSettings)||void 0===i?void 0:i.version)&&void 0!==r?r:"latest"}(o),v=new J(r,f,u[r],e);return s.filter((function(n){return n.destinationName===r})).length>0&&v.addMiddleware(a),v}}}})).filter((function(n){return void 0!==n}))]);var c}))}))}},2734:function(n,t,e){"use strict";e.r(t),e.d(t,{applyDestinationMiddleware:function(){return a},sourceMiddlewarePlugin:function(){return u}});var i=e(655),r=e(7372),o=e(5764),s=e(2722);function a(n,t,e){return(0,i.mG)(this,void 0,Promise,(function(){function r(t,e){return(0,i.mG)(this,void 0,Promise,(function(){var r,a,u;return(0,i.Jh)(this,(function(l){switch(l.label){case 0:return r=!1,a=null,[4,(0,o.O)(e({payload:(0,s.D)(t,{clone:!0,traverse:!1}),integration:n,next:function(n){r=!0,null===n&&(a=null),n&&(a=n.obj)}}))];case 1:return l.sent(),r||null===a||((a=a).integrations=(0,i.pi)((0,i.pi)({},t.integrations),((u={})[n]=!1,u))),[2,a]}}))}))}var a,u,l,c;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:a=0,u=e,n.label=1;case 1:return a<u.length?(l=u[a],[4,r(t,l)]):[3,4];case 2:if(null===(c=n.sent()))return[2,null];t=c,n.label=3;case 3:return a++,[3,1];case 4:return[2,t]}}))}))}function u(n,t){function e(e){return(0,i.mG)(this,void 0,Promise,(function(){var a;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return a=!1,[4,(0,o.O)(n({payload:(0,s.D)(e.event,{clone:!0,traverse:!1}),integrations:null!=t?t:{},next:function(n){a=!0,n&&(e.event=n.obj)}}))];case 1:if(i.sent(),!a)throw new r.Y({retry:!1,type:"middleware_cancellation",reason:"Middleware `next` function skipped"});return[2,e]}}))}))}return{name:"Source Middleware "+n.name,type:"before",version:"0.1.0",isLoaded:function(){return!0},load:function(n){return Promise.resolve(n)},track:e,page:e,identify:e,alias:e,group:e}}}}]);
//# sourceMappingURL=ajs-destination.bundle.b3c9ba070dc87eeae516.js.map